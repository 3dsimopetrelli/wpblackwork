<?php
if ( ! defined( 'ABSPATH' ) ) exit;

class BW_Widget_Loader {
    public function __construct() {
        add_action('elementor/widgets/register', [ $this, 'register_widgets' ]);
    }

    public function register_widgets( $widgets_manager ) {
        $files = glob( __DIR__ . '/widgets/class-bw-*-widget.php' );
        foreach ( $files as $file ) {
            require_once $file;
            $class_name = $this->get_class_from_file($file);
            if ( class_exists($class_name) ) {
                $widgets_manager->register( new $class_name() );
            }
        }
    }

    private function get_class_from_file( $file ) {
        $basename = basename($file, '.php');
        // es: class-bw-slick-slider-widget.php â†’ Widget_Bw_Slick_Slider
        $parts = explode('-', str_replace('class-', '', $basename));
        $class = 'Widget_';
        foreach ($parts as $p) {
            $class .= ucfirst($p) . '_';
        }
        return rtrim($class, '_');
    }
}

new BW_Widget_Loader();
